<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Model Residuals Audit • auditor</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../dalexverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../dalexverse-2.css" rel="stylesheet">
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Model Residuals Audit">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">auditor</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/">MI^2 DataLab</a> </span>
          <span class="version version-default">1.0.0</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/model_evaluation_audit.html">Model Evaluation Audit</a>
    </li>
    <li>
      <a href="../articles/model_fit_audit.html">Model Fit Audit</a>
    </li>
    <li>
      <a href="../articles/model_performance_audit.html">Model Performance Audit</a>
    </li>
    <li>
      <a href="../articles/model_residuals_audit.html">Model Residuals Audit</a>
    </li>
    <li>
      <a href="../articles/observation_influence_audit.html">Observation Influence Audit</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/auditor">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Model Residuals Audit</h1>
                        <h4 class="author">Alicja Gosiewska</h4>
            
            <h4 class="date">2019-09-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ModelOriented/auditor/blob/master/vignettes/model_residuals_audit.Rmd"><code>vignettes/model_residuals_audit.Rmd</code></a></small>
      <div class="hidden name"><code>model_residuals_audit.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates how to use the <em>auditor</em> package for auditing residuals of models. The auditor provides methods for model verification and validation by error analysis.</p>
<p>Many models, such as random forests and neutral networks are nowadays treated as black boxes. Therefore, there is a lack of theory that describes the behavior of errors in those models. Most methods provided in auditor package are model-agnostic, so can be used regardless of knowledge about errors.</p>
<p>Some of the graphical error analysis methods also have corresponding scores, which allow comparison of two models.</p>
<div id="regression-use-case---dragons-data" class="section level1">
<h1 class="hasAnchor">
<a href="#regression-use-case---dragons-data" class="anchor"></a>Regression use case - dragons data</h1>
<p>To illustrate applications of <em>auditor</em> to regression problems we will use an artificial dataset dragons available in the <a href="https://github.com/pbiecek/DALEX"><em>DALEX</em></a> package. Our goal is to predict the length of life of dragons.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(DALEX)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"dragons"</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(dragons)</a></code></pre></div>
<pre><code>##   year_of_birth   height   weight scars colour year_of_discovery
## 1         -1291 59.40365 15.32391     7    red              1700
## 2          1589 46.21374 11.80819     5    red              1700
## 3          1528 49.17233 13.34482     6    red              1700
## 4          1645 48.29177 13.27427     5  green              1700
## 5            -8 49.99679 13.08757     1    red              1700
## 6           915 45.40876 11.48717     2    red              1700
##   number_of_lost_teeth life_length
## 1                   25   1368.4331
## 2                   28   1377.0474
## 3                   38   1603.9632
## 4                   33   1434.4222
## 5                   18    985.4905
## 6                   20    969.5682</code></pre>
</div>
<div id="models" class="section level1">
<h1 class="hasAnchor">
<a href="#models" class="anchor"></a>Models</h1>
<div id="linear-model" class="section level2">
<h2 class="hasAnchor">
<a href="#linear-model" class="anchor"></a>Linear model</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">lm_model &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(life_length <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> dragons)</a></code></pre></div>
</div>
<div id="random-forest" class="section level2">
<h2 class="hasAnchor">
<a href="#random-forest" class="anchor"></a>Random forest</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"randomForest"</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">59</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">rf_model &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span>(life_length <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> dragons)</a></code></pre></div>
</div>
</div>
<div id="preparation-for-error-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#preparation-for-error-analysis" class="anchor"></a>Preparation for error analysis</h1>
<p>The beginning of each analysis is creation of an <code>explainer</code> object with DALEX package. It’s an object that can be used to audit a model.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">lm_exp &lt;-<span class="st"> </span>DALEX<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/DALEX/man/explain.html">explain</a></span>(lm_model, <span class="dt">label =</span> <span class="st">"lm"</span>, <span class="dt">data =</span> dragons, <span class="dt">y =</span> dragons<span class="op">$</span>life_length)</a></code></pre></div>
<pre><code>## Preparation of a new explainer is initiated
##   -&gt; model label       :  lm 
##   -&gt; data              :  2000  rows  8  cols 
##   -&gt; target variable   :  2000  values 
##   -&gt; predict function  :  yhat.lm  will be used ([33mdefault[39m)
##   -&gt; predicted values  :  numerical, min =  540.9447 , mean =  1370.986 , max =  3925.691  
##   -&gt; residual function :  difference between y and yhat ([33mdefault[39m)
##   -&gt; residuals         :  numerical, min =  -108.2062 , mean =  -3.701928e-12 , max =  113.8603  
## [32mA new explainer has been created![39m</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">rf_exp &lt;-<span class="st"> </span>DALEX<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/DALEX/man/explain.html">explain</a></span>(rf_model, <span class="dt">label =</span> <span class="st">"rf"</span>, <span class="dt">data =</span> dragons, <span class="dt">y =</span> dragons<span class="op">$</span>life_length)</a></code></pre></div>
<pre><code>## Preparation of a new explainer is initiated
##   -&gt; model label       :  rf 
##   -&gt; data              :  2000  rows  8  cols 
##   -&gt; target variable   :  2000  values 
##   -&gt; predict function  :  yhat.randomForest  will be used ([33mdefault[39m)
##   -&gt; predicted values  :  numerical, min =  610.9752 , mean =  1370.181 , max =  3292.296  
##   -&gt; residual function :  difference between y and yhat ([33mdefault[39m)
##   -&gt; residuals         :  numerical, min =  -135.4756 , mean =  0.8047108 , max =  720.0888  
## [32mA new explainer has been created![39m</code></pre>
</div>
<div id="audit-of-residuals" class="section level1">
<h1 class="hasAnchor">
<a href="#audit-of-residuals" class="anchor"></a>Audit of residuals</h1>
<p>In this section we give short overview of a visual validation of model errors and show the propositions for the validation scores. Auditor helps to find answers for questions that may be crucial for further analyses.</p>
<ul>
<li><p>Does the model fit data? Is it not missing the information?</p></li>
<li><p>Which model has better performance?</p></li>
<li><p>How similar models are?</p></li>
</ul>
<p>In further sections we will overview auditor functions for analysis of model residuals. They are discussed in alphabetical order.</p>
<div id="model_residual" class="section level2">
<h2 class="hasAnchor">
<a href="#model_residual" class="anchor"></a>model_residual()</h2>
<p>In this vignette we use first pipeline. However, alternative evaluations are showed as comments. First, we need to create a <code>modelResiduals</code> objects.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(auditor)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">lm_mr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/model_residual.html">model_residual</a></span>(lm_exp)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">rf_mr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/model_residual.html">model_residual</a></span>(rf_exp)</a></code></pre></div>
</div>
<div id="plots" class="section level2">
<h2 class="hasAnchor">
<a href="#plots" class="anchor"></a>Plots</h2>
<div id="plot_acf---autocorrelation-function-of-residuals" class="section level3">
<h3 class="hasAnchor">
<a href="#plot_acf---autocorrelation-function-of-residuals" class="anchor"></a>plot_acf() - Autocorrelation Function of Residuals</h3>
<p>Autocorrelation Function plot can be used to check randomness of errors. If random, autocorrelations should be near zero for lag separations. If non-random, then autocorrelations will be significantly non-zero.</p>
<p>Residuals may be ordered by values of any model variable or by fitted values. If variable is not specified, function takes order from the data set.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(lm_mr, <span class="dt">type =</span> <span class="st">"acf"</span>, <span class="dt">variable =</span> <span class="st">"year_of_discovery"</span>)</a></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># alternative:</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="co"># plot_acf(lm_mr, variable = "year_of_discovery")</span></a></code></pre></div>
</div>
<div id="plot_autocorrelation---autocorrelation-of-residuals" class="section level3">
<h3 class="hasAnchor">
<a href="#plot_autocorrelation---autocorrelation-of-residuals" class="anchor"></a>plot_autocorrelation() - Autocorrelation of Residuals</h3>
<p>On the Autocorrelation plot there are i-th vs i+1-th residuals. This plot may be useful for checking autocorrelation of residuals.</p>
<p>Sometimes it is difficult to compare two models basing only on visualizations. Therefore, we have proposed some scores, which may be useful for choosing a better model.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(rf_mr, <span class="dt">type =</span> <span class="st">"autocorrelation"</span>)</a></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># alternative:</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="co"># plot_autocorrelation(rf_mr)</span></a></code></pre></div>
<p>DW score and Runs score are based on Durbin-Watson and Runs test statistics.</p>
<p>Scores can be calculated with the <code><a href="../reference/score_dw.html">scoreDW()</a></code> and <code><a href="../reference/score_runs.html">scoreRuns()</a></code> functions or the <code><a href="../reference/score.html">score()</a></code> function with argument <code>score</code> equals to “DW” or “Runs”.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">rf_score_dw &lt;-<span class="st"> </span><span class="kw"><a href="../reference/score_dw.html">score_dw</a></span>(rf_exp)</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">rf_score_runs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/score_runs.html">score_runs</a></span>(rf_exp)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"></a>
<a class="sourceLine" id="cb14-4" data-line-number="4">rf_score_dw<span class="op">$</span>score</a></code></pre></div>
<pre><code>## [1] 1.951918</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">rf_score_runs<span class="op">$</span>score</a></code></pre></div>
<pre><code>## [1] -1.881788</code></pre>
</div>
<div id="plot_correlation---correlation-of-models" class="section level3">
<h3 class="hasAnchor">
<a href="#plot_correlation---correlation-of-models" class="anchor"></a>plot_correlation - Correlation of Models</h3>
<p>A grid of plots presents correlation of dependennt variable and fitted model values.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(rf_mr, lm_mr, <span class="dt">type =</span> <span class="st">"correlation"</span>)</a></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co"># alternative:</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="co"># plotM_correlation(rf_mr, lm_mr)</span></a></code></pre></div>
</div>
<div id="plot_pca---model-pca" class="section level3">
<h3 class="hasAnchor">
<a href="#plot_pca---model-pca" class="anchor"></a>plot_pca() - Model PCA</h3>
<p>Principal Component Analysis of models residuals. PCA can be used to assess the similarity of the models.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(rf_mr, lm_mr, <span class="dt">type =</span> <span class="st">"pca"</span>)</a></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># alternative:</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="co"># plot_pca(rf_audit, lm_audit)</span></a></code></pre></div>
</div>
<div id="plot_predition---observed-vs-predicted" class="section level3">
<h3 class="hasAnchor">
<a href="#plot_predition---observed-vs-predicted" class="anchor"></a>plot_predition() - Observed vs Predicted</h3>
<p>Basic plot of residuals vs observed, fitted or variable values. If variable is not specified, function takes order from the data set.</p>
<p>Black line corresponds to the y=x function.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(rf_mr, lm_mr, <span class="dt">variable =</span> <span class="st">"life_length"</span>, <span class="dt">type =</span> <span class="st">"prediction"</span>)</a></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="co"># alternative:</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="co"># plot_prediction(rf_audit, lm_audit, variable = "life_length")</span></a></code></pre></div>
<p>Predictions may be ordered by values any model variable or by fitted values. And both models may be plotted together.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(rf_mr, lm_mr, <span class="dt">type =</span> <span class="st">"prediction"</span>)</a></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="co"># alternative:</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="co"># plot_prediction(rf_mr, lm_mr)</span></a></code></pre></div>
</div>
<div id="plot_rec---regression-error-characteristic-rec-curve" class="section level3">
<h3 class="hasAnchor">
<a href="#plot_rec---regression-error-characteristic-rec-curve" class="anchor"></a>plot_rec() - Regression Error Characteristic (REC) Curve</h3>
<p>Error Characteristic curves are a generalization of ROC curves. On the x axis of the plot there is an error tolerance and on the y axis there is a percentage of observations predicted within the given tolerance. REC curve estimates the Cumulative Distribution Function (CDF) of the error. Area Over the REC Curve (REC) is a biased estimate of the expected error.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(rf_mr, lm_mr, <span class="dt">type =</span> <span class="st">"rec"</span>)</a></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="co"># alternative:</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="co"># plot_rec(rf_mr, lm_mr)</span></a></code></pre></div>
</div>
<div id="plot_residual---plot-residuals-vs-observed-fitted-or-variable-values" class="section level3">
<h3 class="hasAnchor">
<a href="#plot_residual---plot-residuals-vs-observed-fitted-or-variable-values" class="anchor"></a>plot_residual() - Plot Residuals vs Observed, Fitted or Variable Values</h3>
<p>Basic plot of residuals vs observed, fitted or variable values. It provides information about the structure of the model.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(rf_mr, <span class="dt">type =</span> <span class="st">"residual"</span>)</a></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="co"># alternative:</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="co"># plot_residual(rf_mr)</span></a></code></pre></div>
<p>Residuals may be ordered by values any model variable or by fitted values. And both models may be plotted together. If variable is not specified, function takes order from the data set.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(rf_mr, lm_mr, <span class="dt">type =</span> <span class="st">"residual"</span>, <span class="dt">variable =</span> <span class="st">"_y_hat_"</span>)</a></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="co"># alternative:</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="co"># plot_residual(rf_mr, lm_mr, variable = "_y_hat_")</span></a></code></pre></div>
</div>
<div id="plotresidualboxplot---boxplot-of-residuals" class="section level3">
<h3 class="hasAnchor">
<a href="#plotresidualboxplot---boxplot-of-residuals" class="anchor"></a>plotResidualBoxplot() - Boxplot of residuals</h3>
<p>Comparison of the absolute valued of residuals. The red dot stands for the root mean square.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(lm_mr, rf_mr, <span class="dt">type =</span> <span class="st">"residual_boxplot"</span>)</a></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="co"># alternative</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="co"># plot_residual_boxplot(lm_mr, rf_mr)</span></a></code></pre></div>
</div>
<div id="plot_residual_density---density-of-residuals" class="section level3">
<h3 class="hasAnchor">
<a href="#plot_residual_density---density-of-residuals" class="anchor"></a>plot_residual_density() - Density of Residuals</h3>
<p>Density of residuals may be plotted in different ways. Residuals of models may be simply compared.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(rf_mr, lm_mr, <span class="dt">type =</span> <span class="st">"residual_density"</span>)</a></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="co"># alternative</span></a>
<a class="sourceLine" id="cb35-2" data-line-number="2"><span class="co"># plot_residual_density(rf_mr, lm_mr)</span></a></code></pre></div>
<p>Resuduals may be also divided by median of the numeric variable and splitted by a factor variable</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw"><a href="../reference/plot_residual_density.html">plot_residual_density</a></span>(rf_mr, lm_mr, <span class="dt">variable =</span> <span class="st">"life_length"</span>)</a></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
</div>
<div id="plot_rroc---regression-receiver-operating-characteristic-rroc" class="section level3">
<h3 class="hasAnchor">
<a href="#plot_rroc---regression-receiver-operating-characteristic-rroc" class="anchor"></a>plot_rroc() - Regression Receiver Operating Characteristic (RROC)</h3>
<p>The basic idea of the ROC curves for regression is to show model asymmetry. The RROC is a plot where on the x-axis we depict total over-estimation and on the y-axis total under-estimation.</p>
<p>For RROC curves we use a shift, which is an equvalent to the threshold for ROC curves. For each observation we calculate new prediction:  where s is the shift. Therefore, there are different error values for each shift: </p>
<p>Over-estimation is caluclates as: . Under-estimation is calculated as: . The shift equals 0 is represented by a dot.</p>
<p>The Area Over the RROC Curve (AOC) equals to the variance of the errors multiplied by .</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(rf_mr, lm_mr, <span class="dt">type =</span> <span class="st">"rroc"</span>)</a></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="co"># alternative:</span></a>
<a class="sourceLine" id="cb38-2" data-line-number="2"><span class="co"># plot_rroc(rf_mr, lm_mr)</span></a></code></pre></div>
</div>
<div id="plot_scalelocation---scale-location-plot" class="section level3">
<h3 class="hasAnchor">
<a href="#plot_scalelocation---scale-location-plot" class="anchor"></a>plot_scalelocation() - Scale Location Plot</h3>
<p>This plot shows if residuals are spread equally along the ranges of predictors.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(rf_mr, lm_mr, <span class="dt">type =</span> <span class="st">"scalelocation"</span>)</a></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="co"># alternative:</span></a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="co"># plot_scalelocation(rf_mr, lm_mr)</span></a></code></pre></div>
<p>For comparing 2 models we can use GQ score, which is based on Goldfeld-Quandt test statistic. And may be computed also in <code><a href="../reference/score.html">score()</a></code> function with argument <code>score</code> equals “GQ”.</p>
</div>
<div id="plot_tsecdf---two-sided-empirical-cumulative-distribution-function-ecdf" class="section level3">
<h3 class="hasAnchor">
<a href="#plot_tsecdf---two-sided-empirical-cumulative-distribution-function-ecdf" class="anchor"></a>plot_tsecdf() - Two-sided Empirical Cumulative Distribution Function (ECDF)</h3>
<p>Cumulative Distribution Function for positive and negative residuals.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(rf_mr, lm_mr, <span class="dt">type =</span> <span class="st">"tsecdf"</span>)</a></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="co"># alternative</span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="co"># plot_tsecdf(rf_audit, lm_audit)</span></a></code></pre></div>
</div>
</div>
<div id="other-methods" class="section level2">
<h2 class="hasAnchor">
<a href="#other-methods" class="anchor"></a>Other methods</h2>
<p>Other methods and plots are described in vignettes:</p>
<ul>
<li><p><a href="https://modeloriented.github.io/auditor/articles/model_fit_audit.html">Model Evaluation audit</a></p></li>
<li><p><a href="https://modeloriented.github.io/auditor/articles/model_evaluation_audit.html">Model Fit audit</a></p></li>
<li><p><a href="https://modeloriented.github.io/auditor/articles/model_performance_audit.html">Model Performance audit</a></p></li>
<li><p><a href="https://modeloriented.github.io/auditor/articles/observation_influence_audit.html">Observation Influence audit</a></p></li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#regression-use-case---dragons-data">Regression use case - dragons data</a></li>
      <li>
<a href="#models">Models</a><ul class="nav nav-pills nav-stacked">
<li><a href="#linear-model">Linear model</a></li>
      <li><a href="#random-forest">Random forest</a></li>
      </ul>
</li>
      <li><a href="#preparation-for-error-analysis">Preparation for error analysis</a></li>
      <li>
<a href="#audit-of-residuals">Audit of residuals</a><ul class="nav nav-pills nav-stacked">
<li><a href="#model_residual">model_residual()</a></li>
      <li><a href="#plots">Plots</a></li>
      <li><a href="#other-methods">Other methods</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="author">
  <p>
    Developed by Alicja Gosiewska, Przemyslaw Biecek, Hubert Baniecki, Tomasz Mikołajczyk.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
