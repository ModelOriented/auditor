<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Model performance audit • auditor</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="../dalexverse.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../dalexverse-2.css" rel="stylesheet">
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Model performance audit">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">auditor</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/">MI^2 DataLab</a> </span>
          <span class="version version-default">1.1.1</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/model_evaluation_audit.html">Model evaluation audit</a>
    </li>
    <li>
      <a href="../articles/model_fit_audit.html">Model fit audit</a>
    </li>
    <li>
      <a href="../articles/model_performance_audit.html">Model performance audit</a>
    </li>
    <li>
      <a href="../articles/model_residuals_audit.html">Model residuals audit</a>
    </li>
    <li>
      <a href="../articles/observation_influence_audit.html">Observation influence audit</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/auditor">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Model performance audit</h1>
                        <h4 class="author">Alicja Gosiewska</h4>
            
            <h4 class="date">2019-10-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ModelOriented/auditor/blob/master/vignettes/model_performance_audit.Rmd"><code>vignettes/model_performance_audit.Rmd</code></a></small>
      <div class="hidden name"><code>model_performance_audit.Rmd</code></div>

    </div>

    
    
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>To illustrate application of <code>auditor</code> we will use dataset “dragons” available in the <a href="https://github.com/pbiecek/DALEX"><code>DALEX</code></a> package. The dataset contains characteristics of fictional creatures (dragons), like year of birth, height, weight, etc (see below). The goal is to predict the length of life of dragons (a regression problem).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(DALEX)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(dragons)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(dragons)</a></code></pre></div>
<pre><code>##   year_of_birth   height   weight scars colour year_of_discovery
## 1         -1291 59.40365 15.32391     7    red              1700
## 2          1589 46.21374 11.80819     5    red              1700
## 3          1528 49.17233 13.34482     6    red              1700
## 4          1645 48.29177 13.27427     5  green              1700
## 5            -8 49.99679 13.08757     1    red              1700
## 6           915 45.40876 11.48717     2    red              1700
##   number_of_lost_teeth life_length
## 1                   25   1368.4331
## 2                   28   1377.0474
## 3                   38   1603.9632
## 4                   33   1434.4222
## 5                   18    985.4905
## 6                   20    969.5682</code></pre>
</div>
<div id="models" class="section level2">
<h2 class="hasAnchor">
<a href="#models" class="anchor"></a>Models</h2>
<p>First, we need models to compare. We selected linear regression and random forest because of their different structures. Linear regression model linear relationships between target response and independent variables. While random forest should be able to capture also non-linear relationships between variables.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># Linear regression</span></a>
<a class="sourceLine" id="cb3-2" title="2">lm_model &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(life_length <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> dragons)</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co"># Random forest</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(randomForest)</a>
<a class="sourceLine" id="cb3-6" title="6"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">59</span>)</a>
<a class="sourceLine" id="cb3-7" title="7">rf_model &lt;-<span class="st"> </span><span class="kw">randomForest</span>(life_length <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> dragons)</a></code></pre></div>
</div>
<div id="preparation-for-analysis-of-performance" class="section level2">
<h2 class="hasAnchor">
<a href="#preparation-for-analysis-of-performance" class="anchor"></a>Preparation for analysis of performance</h2>
<p>Analysis begins with creation of an explainer object with <code>explain</code> function from <code>DALEX</code> package. Explainer wraps a model with its meta-data, such as dataset that was used for training or observed response.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">lm_exp &lt;-<span class="st"> </span>DALEX<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/DALEX/man/explain.html">explain</a></span>(lm_model, <span class="dt">label =</span> <span class="st">"lm"</span>, <span class="dt">data =</span> dragons, <span class="dt">y =</span> dragons<span class="op">$</span>life_length)</a>
<a class="sourceLine" id="cb4-2" title="2">rf_exp &lt;-<span class="st"> </span>DALEX<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/DALEX/man/explain.html">explain</a></span>(rf_model, <span class="dt">label =</span> <span class="st">"rf"</span>, <span class="dt">data =</span> dragons, <span class="dt">y =</span> dragons<span class="op">$</span>life_length)</a></code></pre></div>
<p>Next step requires creation of <code>model_performance</code> objects of each explained model. The function computes chosen performance measures for passed model.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(auditor)</a>
<a class="sourceLine" id="cb5-2" title="2">lm_mp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/model_performance.html">model_performance</a></span>(lm_exp)</a>
<a class="sourceLine" id="cb5-3" title="3">rf_mp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/model_performance.html">model_performance</a></span>(rf_exp)</a>
<a class="sourceLine" id="cb5-4" title="4"></a>
<a class="sourceLine" id="cb5-5" title="5">lm_mp</a></code></pre></div>
<pre><code>## Model label:  lm 
##             score name
## mae  3.334652e+01  mae
## mse  1.656454e+03  mse
## rec  3.330139e+01  rec
## rroc 3.310782e+09 rroc</code></pre>
</div>
<div id="model-ranking-radar-plot" class="section level2">
<h2 class="hasAnchor">
<a href="#model-ranking-radar-plot" class="anchor"></a>Model ranking radar plot</h2>
<p>Model performance measures may be plotted together to easily compare model performances. A result further from the center of the plot means a better model performance. Parameter <code>verbose</code> indicates whether the table with scores should be generated. On the plot scores are inversed and scaled to [0,1].</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(lm_mp, rf_mp)</a></code></pre></div>
<pre><code>##   name label    value scaled
## 1  mae    lm 3.33e+01  1.000
## 2  mae    rf 2.79e+01  0.835
## 3  mse    lm 1.66e+03  1.000
## 4  mse    rf 2.39e+03  1.443
## 5  rec    lm 3.33e+01  1.000
## 6  rec    rf 2.77e+01  0.831
## 7 rroc    lm 3.31e+09  1.000
## 8 rroc    rf 4.75e+09  1.434</code></pre>
<p><img src="model_performance_audit_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="co"># alternative:</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="co"># plot_radar(lm_mp, rf_mp, verbose = FALSE)</span></a></code></pre></div>
<p>There is a possibiliy to define functions with custom model performance measure.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">new_score &lt;-<span class="st"> </span><span class="cf">function</span>(object) <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(object<span class="op">$</span>residuals)))</a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3">lm_mp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/model_performance.html">model_performance</a></span>(lm_exp,  </a>
<a class="sourceLine" id="cb10-4" title="4">                          <span class="dt">score =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"mae"</span>, <span class="st">"mse"</span>, <span class="st">"rec"</span>, <span class="st">"rroc"</span>), </a>
<a class="sourceLine" id="cb10-5" title="5">                          <span class="dt">new_score =</span> new_score)</a>
<a class="sourceLine" id="cb10-6" title="6"></a>
<a class="sourceLine" id="cb10-7" title="7">rf_mp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/model_performance.html">model_performance</a></span>(rf_exp,  </a>
<a class="sourceLine" id="cb10-8" title="8">                          <span class="dt">score =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"mae"</span>, <span class="st">"mse"</span>, <span class="st">"rec"</span>, <span class="st">"rroc"</span>), </a>
<a class="sourceLine" id="cb10-9" title="9">                          <span class="dt">new_score =</span> new_score)</a>
<a class="sourceLine" id="cb10-10" title="10"></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(lm_mp, rf_mp)</a></code></pre></div>
<pre><code>##         name label    value scaled
## 1        mae    lm 3.33e+01  1.000
## 2        mae    rf 2.79e+01  0.835
## 3        mse    lm 1.66e+03  1.000
## 4        mse    rf 2.39e+03  1.443
## 5        rec    lm 3.33e+01  1.000
## 6        rec    rf 2.77e+01  0.831
## 7       rroc    lm 3.31e+09  1.000
## 8       rroc    rf 4.75e+09  1.434
## 9  new_score    lm 1.07e+04  1.000
## 10 new_score    rf 9.25e+03  0.864</code></pre>
<p><img src="model_performance_audit_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div id="other-methods" class="section level2">
<h2 class="hasAnchor">
<a href="#other-methods" class="anchor"></a>Other methods</h2>
<p>Other methods and plots are described in vignettes:</p>
<ul>
<li><a href="https://modeloriented.github.io/auditor/articles/model_residuals_audit.html">Model residuals audit</a></li>
<li><a href="https://modeloriented.github.io/auditor/articles/model_evaluation_audit.html">Model evaluation audit</a></li>
<li><a href="https://modeloriented.github.io/auditor/articles/model_fit_audit.html">Model fit audit</a></li>
<li><a href="https://modeloriented.github.io/auditor/articles/observation_influence_audit.html">Observation influence audit</a></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#data">Data</a></li>
      <li><a href="#models">Models</a></li>
      <li><a href="#preparation-for-analysis-of-performance">Preparation for analysis of performance</a></li>
      <li><a href="#model-ranking-radar-plot">Model ranking radar plot</a></li>
      <li><a href="#other-methods">Other methods</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="author">
  <p>
    Developed by Alicja Gosiewska, Przemyslaw Biecek, Hubert Baniecki, Tomasz Mikołajczyk.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
</div>

  


  </body>
</html>
