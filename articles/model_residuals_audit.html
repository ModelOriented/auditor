<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Model residuals audit • auditor</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- dalexverse --><link href="../dalexverse.css" rel="stylesheet">
<link href="../dalexverse-2.css" rel="stylesheet">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Model residuals audit">
<meta property="og:description" content="auditor">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">auditor</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/">MI^2 DataLab</a> </span>
          <span class="version version-default">1.3.3</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/model_evaluation_audit.html">Model evaluation audit</a>
    </li>
    <li>
      <a href="../articles/model_fit_audit.html">Model fit audit</a>
    </li>
    <li>
      <a href="../articles/model_performance_audit.html">Model performance audit</a>
    </li>
    <li>
      <a href="../articles/model_residuals_audit.html">Model residuals audit</a>
    </li>
    <li>
      <a href="../articles/observation_influence_audit.html">Observation influence audit</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/auditor/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="model_residuals_audit_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Model residuals audit</h1>
                        <h4 class="author">Alicja Gosiewska, Tomasz Mikołajczyk</h4>
            
            <h4 class="date">2021-07-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ModelOriented/auditor/blob/master/vignettes/model_residuals_audit.Rmd"><code>vignettes/model_residuals_audit.Rmd</code></a></small>
      <div class="hidden name"><code>model_residuals_audit.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates how to use the <a href="https://github.com/ModelOriented/auditor"><code>auditor</code></a> package for auditing <strong>residuals</strong> of machine learning models. The residual is the difference between the observed value and the value predicted by model. The auditor provides methods for model verification and validation by error analysis. It helps in finding answers to questions that may be crucial in deeper analyses.</p>
<ul>
<li>Does the model fit the data? Is it not missing any information?</li>
<li>Which model has better performance?</li>
<li>How similar are models?</li>
</ul>
<p>Many algorithms, such as random forests and neutral networks are sometimes treated as black boxes and there is a lack of techniques that help in the analysis of errors in those models. Most methods provided in auditor package are model-agnostic, what means that they can be used regardless of expected distribution of residuals.</p>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>Use case - predicting a length of life</p>
<p>To illustrate application of <code>auditor</code> we will use dataset “dragons” available in the <a href="https://github.com/pbiecek/DALEX"><code>DALEX</code></a> package. The dataset contains characteristics of fictional creatures (dragons), like year of birth, height, weight, etc (see below). The goal is to predict the length of life of dragons (a regression problem).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dalex.drwhy.ai">DALEX</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">dragons</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">dragons</span><span class="op">)</span></code></pre></div>
<pre><code>##   year_of_birth   height   weight scars colour year_of_discovery
## 1         -1291 59.40365 15.32391     7    red              1700
## 2          1589 46.21374 11.80819     5    red              1700
## 3          1528 49.17233 13.34482     6    red              1700
## 4          1645 48.29177 13.27427     5  green              1700
## 5            -8 49.99679 13.08757     1    red              1700
## 6           915 45.40876 11.48717     2    red              1700
##   number_of_lost_teeth life_length
## 1                   25   1368.4331
## 2                   28   1377.0474
## 3                   38   1603.9632
## 4                   33   1434.4222
## 5                   18    985.4905
## 6                   20    969.5682</code></pre>
</div>
<div id="models" class="section level2">
<h2 class="hasAnchor">
<a href="#models" class="anchor"></a>Models</h2>
<p>First, we need models to compare. We selected linear regression and random forest because of their different structures. Linear regression model linear relationships between target response and independent variables, while random forest should be able to capture also non-linear relationships between variables.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Linear regression</span>
<span class="va">lm_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">life_length</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">dragons</span><span class="op">)</span>

<span class="co"># Random forest</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.stat.berkeley.edu/~breiman/RandomForests/">randomForest</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">59</span><span class="op">)</span>
<span class="va">rf_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/randomForest/man/randomForest.html">randomForest</a></span><span class="op">(</span><span class="va">life_length</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">dragons</span><span class="op">)</span></code></pre></div>
</div>
<div id="preparation-for-residual-error-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#preparation-for-residual-error-analysis" class="anchor"></a>Preparation for residual (error) analysis</h2>
<p>Analysis begins with creation of an explainer object with <code>explain</code> function from <code>DALEX</code> package. Explainer wraps a model with its meta-data, such as dataset that was used for training or observed response.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lm_exp</span> <span class="op">&lt;-</span> <span class="fu">DALEX</span><span class="fu">::</span><span class="fu"><a href="https://dalex.drwhy.ai/reference/explain.html">explain</a></span><span class="op">(</span><span class="va">lm_model</span>, label <span class="op">=</span> <span class="st">"lm"</span>, data <span class="op">=</span> <span class="va">dragons</span>, y <span class="op">=</span> <span class="va">dragons</span><span class="op">$</span><span class="va">life_length</span><span class="op">)</span>
<span class="va">rf_exp</span> <span class="op">&lt;-</span> <span class="fu">DALEX</span><span class="fu">::</span><span class="fu"><a href="https://dalex.drwhy.ai/reference/explain.html">explain</a></span><span class="op">(</span><span class="va">rf_model</span>, label <span class="op">=</span> <span class="st">"rf"</span>, data <span class="op">=</span> <span class="va">dragons</span>, y <span class="op">=</span> <span class="va">dragons</span><span class="op">$</span><span class="va">life_length</span><span class="op">)</span></code></pre></div>
<p>Next step requires creation of <code>model_residual</code> objects of each explainer. From this step on, only <code>auditor</code> functions will be used.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ModelOriented/auditor">auditor</a></span><span class="op">)</span>
<span class="va">lm_mr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_residual.html">model_residual</a></span><span class="op">(</span><span class="va">lm_exp</span><span class="op">)</span>
<span class="va">rf_mr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_residual.html">model_residual</a></span><span class="op">(</span><span class="va">rf_exp</span><span class="op">)</span></code></pre></div>
</div>
<div id="plots" class="section level2">
<h2 class="hasAnchor">
<a href="#plots" class="anchor"></a>Plots</h2>
<p>In the following section, we show individual plotting functions which demonstrate different aspects of residual analysis. We devote more attention to selected functions, but usage of each function is more or less similar.</p>
<div id="observed-vs-predicted" class="section level3">
<h3 class="hasAnchor">
<a href="#observed-vs-predicted" class="anchor"></a>Observed vs predicted</h3>
<p>First plot is a basic plot comparising predicted versus observed values. The red line corresponds to the <code>y = x</code> function. The patterns for both models are non-random around the diagonal line. The points corresponding to a random forest (darker dots) show the tendency to underprediction for large values of observed response. Points for linear model (lighter dots) are located more or less around diagonal line which means that this model predicts quite well.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rf_mr</span>, <span class="va">lm_mr</span>, type <span class="op">=</span> <span class="st">"prediction"</span>, abline <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># alternatives:</span>
<span class="co"># plot_prediction(rf_mr, lm_mr, abline = TRUE)</span>
<span class="co"># plot_prediction(rf_mr, lm_mr, variable = "life_length")</span></code></pre></div>
<p>Function <code>plot_prediction</code> presents observed values on the x-axis. However, on the x-axis there may be values of any model variable or observations ordered by index (<code>variable = NULL</code>).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rf_mr</span>, <span class="va">lm_mr</span>, variable <span class="op">=</span> <span class="st">"scars"</span>, type <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rf_mr</span>, <span class="va">lm_mr</span>, variable <span class="op">=</span> <span class="st">"height"</span>, type <span class="op">=</span> <span class="st">"prediction"</span><span class="op">)</span></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/dodge-st-1.png" width="50%"><img src="model_residuals_audit_files/figure-html/dodge-st-2.png" width="50%"></p>
<p>As you can notice, on above plots, there is no relationship for variable <code>height</code> and predicted values while for increasing number of <code>scars</code> model predictions also increase of life length. This means that that model captured monotonic relationship between number of scars and length of life of dragon.</p>
</div>
<div id="residuals-vs-observed-fitted-or-variable-values" class="section level3">
<h3 class="hasAnchor">
<a href="#residuals-vs-observed-fitted-or-variable-values" class="anchor"></a>Residuals vs observed, fitted or variable values</h3>
<p>Next function (<code><a href="../reference/plot_residual.html">plot_residual()</a></code>) shows residuals versus observed values. This plot is used to detect dependence of errors, unequal error variances, and outliers. For appropriate model, residuals should not show any functional dependency. Expected mean value should be equal to 0, regardless of <span class="math inline">\(\hat{y}\)</span> values, so any structured arrangement of points suggests a problem with the model. It is worth looking at the observations that clearly differ from the others. If points on the plot are not randomly dispersed around the horizontal axis, it may be presumed that model is not appropriate for the data.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">lm_mr</span>, <span class="va">rf_mr</span>, type <span class="op">=</span> <span class="st">"residual"</span><span class="op">)</span></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># alternative:</span>
<span class="co"># plot_residual(lm_mr, rf_mr)</span></code></pre></div>
<p>Values (residuals) may also be ordered by target variable, fitted values, any other variable or may be presented unordered.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rf_mr</span>, <span class="va">lm_mr</span>, type <span class="op">=</span> <span class="st">"residual"</span>, variable <span class="op">=</span> <span class="st">"_y_hat_"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rf_mr</span>, <span class="va">lm_mr</span>, type <span class="op">=</span> <span class="st">"residual"</span>, variable <span class="op">=</span> <span class="st">"scars"</span><span class="op">)</span>

<span class="co"># alternative:</span>
<span class="co"># plot_residual(rf_mr, lm_mr, variable = "_y_hat_")</span>
<span class="co"># plot_residual(rf_mr, lm_mr, variable = "scars")</span></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-7-1.png" width="50%"><img src="model_residuals_audit_files/figure-html/unnamed-chunk-7-2.png" width="50%"></p>
<p>In all examples above, we can see that linear model is better fitted for the data than random forest, because for the latter one greater values of selected variables residuals are also greater. Additionally, we can identify most outlying observations:</p>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot_residual(rf_mr, variable = "_y_hat_", nlabel = 10)</span></code></pre></div>
</div>
<div id="density-of-residuals" class="section level3">
<h3 class="hasAnchor">
<a href="#density-of-residuals" class="anchor"></a>Density of residuals</h3>
<p>Residual density plot (<code><a href="../reference/plot_residual_density.html">plot_residual_density()</a></code>) detects the incorrect behavior of residuals. The function returns plot with estimated densities of residuals. Their values are displayed as marks along the x axis. For some models, the expected shape of density could be derived from the model assumptions. For example, simple linear model residuals should be normally distributed. However, even if the model does not have an assumption about the distribution of residuals residual density plot may be informative. If most of the residuals are not concentrated around zero, it is likely that the model predictions are biased.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rf_mr</span>, <span class="va">lm_mr</span>, type <span class="op">=</span> <span class="st">"residual_density"</span><span class="op">)</span></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># alternative</span>
<span class="co"># plot_residual_density(rf_mr, lm_mr)</span></code></pre></div>
<p>Residuals may be also divided by values of a chosen variable (median of a numeric variable or levels of a factor).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_residual_density.html">plot_residual_density</a></span><span class="op">(</span><span class="va">rf_mr</span>, <span class="va">lm_mr</span>, variable <span class="op">=</span> <span class="st">"colour"</span><span class="op">)</span></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
<div id="boxplot-of-residuals" class="section level3">
<h3 class="hasAnchor">
<a href="#boxplot-of-residuals" class="anchor"></a>Boxplot of residuals</h3>
<p>Residual boxplot (<code><a href="../reference/plot_residual_boxplot.html">plotResidualBoxplot()</a></code>) shows the distribution of the absolute values of residuals. Boxplot usually presents following values:</p>
<ul>
<li>box width which corresponds to the second and third quartile,</li>
<li>vertical line which reflects median,</li>
<li>the whiskers which extend to the smallest and largest values, no further than 1.5 of interquartile.</li>
</ul>
<p><code>auditor</code> adds another component to the boxplot which is the root mean square error (RMSE) measure, shown as <code>X</code>. For the appropriate model, box should lay near zero. A large spread of values indicates problems with a model. Comparing our two models we can see that random forest model is much more spread (worse) than linear one.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">lm_mr</span>, <span class="va">rf_mr</span>, type <span class="op">=</span> <span class="st">"residual_boxplot"</span><span class="op">)</span></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># alternative</span>
<span class="co"># plot_residual_boxplot(lm_mr, rf_mr)</span></code></pre></div>
</div>
<div id="autocorrelation-function-of-residuals" class="section level3">
<h3 class="hasAnchor">
<a href="#autocorrelation-function-of-residuals" class="anchor"></a>Autocorrelation function of residuals</h3>
<p>Function <code><a href="../reference/plot_acf.html">plot_acf()</a></code> creates plot which is helpful in checking randomness of errors. If errors are random, autocorrelations should be near zero for lag separations. If they are non random, then autocorrelations will be significantly higher than zero. The vertical dashed lines indicate boundaries, where autocorrelations are significantly different than zero.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">lm_mr</span>, type <span class="op">=</span> <span class="st">"acf"</span>, variable <span class="op">=</span> <span class="st">"year_of_discovery"</span><span class="op">)</span></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># alternative:</span>
<span class="co"># plot_acf(lm_mr, variable = "year_of_discovery")</span></code></pre></div>
</div>
<div id="autocorrelation-of-residuals" class="section level3">
<h3 class="hasAnchor">
<a href="#autocorrelation-of-residuals" class="anchor"></a>Autocorrelation of residuals</h3>
<p>Autocorrelation plot (<code><a href="../reference/plot_autocorrelation.html">plot_autocorrelation()</a></code>) shows correlation of <em>i-th</em> vs <em>i+1-th</em> residuals. This plot may be useful for checking autocorrelation of residuals.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rf_mr</span>, type <span class="op">=</span> <span class="st">"autocorrelation"</span><span class="op">)</span></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># alternative:</span>
<span class="co"># plot_autocorrelation(rf_mr)</span></code></pre></div>
<p>….. ….. ….. …. ….. Sometimes it might be difficult to compare two models relying only on visualization. Therefore, two following additional scores may be useful for choosing a better model; scores are based on <em>Durbin-Watson</em> and <em>Runs</em> test statistics. Scores can be calculated with <code><a href="../reference/score_dw.html">score_dw()</a></code> and <code><a href="../reference/score_runs.html">score_runs()</a></code> functions (or the <code><a href="../reference/score.html">score()</a></code> function with <code>score = "dw"</code> or <code>score = "runs"</code>). ….. ….. ….. …. …..</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/score_dw.html">score_dw</a></span><span class="op">(</span><span class="va">rf_exp</span><span class="op">)</span><span class="op">$</span><span class="va">score</span></code></pre></div>
<pre><code>## [1] 1.951918</code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/score_runs.html">score_runs</a></span><span class="op">(</span><span class="va">rf_exp</span><span class="op">)</span><span class="op">$</span><span class="va">score</span></code></pre></div>
<pre><code>## [1] -1.881788</code></pre>
</div>
<div id="correlation-of-models" class="section level3">
<h3 class="hasAnchor">
<a href="#correlation-of-models" class="anchor"></a>Correlation of models</h3>
<p>Function <code><a href="../reference/plot_correlation.html">plot_correlation()</a></code> returns grid of plots with correlation of dependent variable and fitted values of model(s). In the diagonal, there are estimated densities; in the upper triangle two kind of correlations: (1) between models and (2) between predicted and observed values. In the lower triangle, there are scatter plots of these values.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rf_mr</span>, <span class="va">lm_mr</span>, type <span class="op">=</span> <span class="st">"correlation"</span><span class="op">)</span></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># alternative:</span>
<span class="co"># plot_correlation(rf_mr, lm_mr)</span></code></pre></div>
</div>
<div id="principal-component-analysis-pca-of-models" class="section level3">
<h3 class="hasAnchor">
<a href="#principal-component-analysis-pca-of-models" class="anchor"></a>Principal component analysis (PCA) of models</h3>
<p>Function <code><a href="../reference/plot_pca.html">plot_pca()</a></code> can be used to assess the similarity of the models in terms of residuals. The idea of PCA is reducing the dimension of the data set matrix by creating a set of linearly uncorrelated variables called principal components. At the same time, keeping as much variance as possible. Model PCA plot is a biplot. On axis of the plot, there are first two principal components. Grey dots represent observations. Arrows are pointing in the direction of the models projected into a two-dimensional space. The interposition of arrows provides information about the similarity of models in terms of residuals. If they are close to each other, it indicates similar residuals structures.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rf_mr</span>, <span class="va">lm_mr</span>, type <span class="op">=</span> <span class="st">"pca"</span><span class="op">)</span></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># alternative:</span>
<span class="co"># plot_pca(rf_mr, lm_mr)</span></code></pre></div>
</div>
<div id="regression-error-characteristic-curve-rec" class="section level3">
<h3 class="hasAnchor">
<a href="#regression-error-characteristic-curve-rec" class="anchor"></a>Regression error characteristic curve (REC)</h3>
<p>Error characteristic curves are a generalization of ROC curves. On the x-axis of the plot there is an error tolerance and on the y axis there is a percentage of observations predicted within the given tolerance. REC curve estimates the cumulative distribution function (CDF) of the error. Area over the REC curve is a biased estimate of the expected error.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rf_mr</span>, <span class="va">lm_mr</span>, type <span class="op">=</span> <span class="st">"rec"</span><span class="op">)</span></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># alternative:</span>
<span class="co"># plot_rec(rf_mr, lm_mr)</span></code></pre></div>
</div>
<div id="regression-receiver-operating-characteristic-rroc" class="section level3">
<h3 class="hasAnchor">
<a href="#regression-receiver-operating-characteristic-rroc" class="anchor"></a>Regression receiver operating characteristic (RROC)</h3>
<p>The basic idea of the ROC curve for regression is to show model asymmetry. The RROC is a plot where on x-axis total over-estimation is depicted and on the y-axis total under-estimation.</p>
<p>For RROC curves we use a shift which is an equivalent to the threshold for ROC curves. For each observation we calculate new prediction:  where s is the shift. Therefore, there are different error values for each shift: </p>
<p>………………. - over-estimation is calculated as:  - under-estimation is calculated as:  - the shift equals 0 is represented by a dot ……………….</p>
<p>The area over the RROC curve (AOC) equals to the variance of the errors multiplied by .</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rf_mr</span>, <span class="va">lm_mr</span>, type <span class="op">=</span> <span class="st">"rroc"</span><span class="op">)</span></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># alternative:</span>
<span class="co"># plot_rroc(rf_mr, lm_mr)</span></code></pre></div>
</div>
<div id="scale-location" class="section level3">
<h3 class="hasAnchor">
<a href="#scale-location" class="anchor"></a>Scale location</h3>
<p>This plot shows if residuals are spread equally along the ranges of predictors. The presence of any trend suggests that the variance depends on fitted values, which is against the assumption of homoscedasticity. Not every model has an explicit assumption of homogeneous variance, however, the heteroscedasticity may indicates potential problems with the goodness-of-fit.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rf_mr</span>, <span class="va">lm_mr</span>, type <span class="op">=</span> <span class="st">"scalelocation"</span><span class="op">)</span></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># alternative:</span>
<span class="co"># plot_scalelocation(rf_mr, lm_mr)</span></code></pre></div>
</div>
<div id="two-sided-empirical-cumulative-distribution-function-tsecdf" class="section level3">
<h3 class="hasAnchor">
<a href="#two-sided-empirical-cumulative-distribution-function-tsecdf" class="anchor"></a>Two-sided empirical cumulative distribution function (TSECDF)</h3>
<p>Cumulative distribution function for positive and negative residuals. The plot shows the distribution of residuals divided into groups with positive and negative values. It helps to identify the asymmetry of the residuals. Points represent residuals.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rf_mr</span>, <span class="va">lm_mr</span>, type <span class="op">=</span> <span class="st">"tsecdf"</span><span class="op">)</span></code></pre></div>
<p><img src="model_residuals_audit_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># alternative</span>
<span class="co"># plot_tsecdf(rf_mr, lm_mr)</span></code></pre></div>
</div>
</div>
<div id="other-methods" class="section level2">
<h2 class="hasAnchor">
<a href="#other-methods" class="anchor"></a>Other methods</h2>
<p>Other methods and plots are described in following vignettes:</p>
<ul>
<li><a href="https://modeloriented.github.io/auditor/articles/model_fit_audit.html">Model evaluation audit</a></li>
<li><a href="https://modeloriented.github.io/auditor/articles/model_evaluation_audit.html">Model fit audit</a></li>
<li><a href="https://modeloriented.github.io/auditor/articles/model_performance_audit.html">Model performance audit</a></li>
<li><a href="https://modeloriented.github.io/auditor/articles/observation_influence_audit.html">Observation influence audit</a></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Alicja Gosiewska, Przemyslaw Biecek, Hubert Baniecki, Tomasz Mikołajczyk.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
